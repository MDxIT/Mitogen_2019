/*
 * This file was generated by the Gradle 'init' task.
 *
 * This is a general purpose Gradle build.
 * Learn how to create Gradle builds at https://guides.gradle.org/creating-new-gradle-builds/
 */


 apply plugin: 'java'
 apply plugin: 'eclipse'
 apply plugin: 'base'

 group="com.sunquest"
 version = "3.0.1"
 if(System.properties.buildVersion) version = System.properties.buildVersion;

 sourceCompatibility = 1.8



// In this section you declare where to find the dependencies of your project
repositories {
    // Use 'jcenter' for resolving your dependencies.
    // You can declare any Maven/Ivy/file repository here.
   
    maven {
        url "http://gi-dtm1.sunquestinfo.com:8081/nexus/content/groups/public/"
    }
     
     jcenter()
}


buildscript {
    repositories {
        jcenter()
    }
}


def fName = 'mitogenLIMS-' + version 
def distDest = '/mitogenLIMS-' + version
def versionBuild = version


sourceSets {
    main {
        java.srcDirs = ['src/main/java'] 
		
		// This will use gradle to include the resource bundle instead
		// of using the .classpath which is autogenerated.
		resources{
			srcDirs 'lib'
		}
   }
}


// In this section you declare the dependencies for your production and test code
dependencies {


    compile fileTree(dir: 'lib', include: 'uniflow*.jar')
	
	/*
	 * This change plus the one above and the ones in settings.gradle, in addition to the changes to the ixml files
	 * allow for a debuggable session of both frameshift UNIFlow. Be sure to comment out the line above which
	 * compiles the jar file which you won't be using if your using the dual debuggable session.
	 *
	 * compile project(':uniflow')
	*/

	// The Jetty Web server
	compile group: 'org.eclipse.jetty.aggregate', name: 'jetty-all', version: '9.4.15.v20190215'
    compile group: 'org.slf4j', name: 'slf4j-api', version: '1.7.25'
	compile group: 'org.slf4j', name: 'slf4j-log4j12', version: '1.7.25'
	
    // Log4j
    compile group: 'org.apache.logging.log4j', name: 'log4j-api', version: '2.11.0'
      compile group: 'org.apache.logging.log4j', name: 'log4j-core', version: '2.11.0'
    compile group: 'org.apache.logging.log4j', name: 'log4j-iostreams', version: '2.11.0'
    compile group: 'org.apache.logging.log4j', name: 'log4j-web', version: '2.11.0'
    compile group: 'org.apache.logging.log4j', name: 'log4j-slf4j-impl', version: '2.11.0'
	
	compile 'org.apache.pdfbox:pdfbox:2.0.8'
	compile 'org.apache.poi:poi:3.17'
	compile 'org.apache.poi:poi-excelant:3.17'
	compile 'org.apache.poi:poi-ooxml:3.17'
	compile 'org.apache.poi:poi-ooxml-schemas:3.17'
	compile 'org.apache.poi:poi-scratchpad:3.17'

	compile 'org.python:jython-standalone:2.7.1'
	compile 'javax.activation:activation:1.1.1'
	compile 'org.clojure:clojure:1.9.0'
	compile 'com.lowagie:itext:4.2.2'
	
	compile group: 'org.w3c.jigsaw', name: 'jigsaw', version: '2.2.6'
	
	compile group: 'org.jsoup', name: 'jsoup', version: '1.11.3'
	
	compile 'org.apache.httpcomponents:httpcore:4.4.9'
	compile 'org.apache.httpcomponents:httpclient:4.5.5'
	compile 'org.apache.httpcomponents:httpclient-cache:4.5.5'
	compile 'org.apache.httpcomponents:httpclient-win:4.5.5'
	compile 'org.apache.httpcomponents:httpmime:4.5.5'
	compile 'org.apache.httpcomponents:fluent-hc:4.5.5'
	compile group: 'org.apache.commons', name: 'commons-text', version: '1.6'
	compile group: 'org.apache.commons', name: 'commons-lang3', version: '3.8.1'
	compile 'org.apache.xmlgraphics:fop:2.2'
    
	compile 'commons-codec:commons-codec:1.11'
	compile 'commons-fileupload:commons-fileupload:1.3.3'

	compile group: 'org.javalite', name: 'activejdbc', version: '2.2'
	compile group: 'org.javalite', name: 'activejdbc-instrumentation', version: '2.1'

	compile group: 'org.jboss.resteasy', name: 'resteasy-jaxrs', version: '3.6.3.Final'
	compile group: 'org.jboss.resteasy', name: 'resteasy-client', version: '3.6.3.Final'
	compile group: 'org.jboss.resteasy', name: 'resteasy-atom-provider', version: '3.6.3.Final'
	compile group: 'org.jboss.resteasy', name: 'resteasy-jackson2-provider', version: '3.6.3.Final'
	compile group: 'org.jboss.resteasy', name: 'resteasy-multipart-provider', version: '3.6.3.Final'
	compile group: 'org.jboss.resteasy', name: 'resteasy-cdi', version: '3.6.3.Final'
	// required for resteasy validation
	compile group: 'org.jboss.resteasy', name: 'resteasy-validator-provider-11', version: '3.6.3.Final'
	compile group: 'javax.el', name: 'javax.el-api', version: '3.0.1-b06'
	
    compile group: 'com.jcraft', name: 'jsch', version: '0.1.44-1'
	

	compile group: 'com.fasterxml.jackson.core', name: 'jackson-core', version: '2.9.8'
	compile group: 'com.fasterxml.jackson.core', name: 'jackson-databind', version: '2.9.8'
	compile group: 'com.fasterxml.jackson.core', name: 'jackson-annotations', version: '2.9.8'
	compile group: 'com.fasterxml.jackson.jaxrs', name: 'jackson-jaxrs-json-provider', version: '2.9.8'
	compile group: 'com.fasterxml.jackson.datatype', name: 'jackson-datatype-jdk8', version: '2.9.8'
	compile group: 'com.fasterxml.jackson.dataformat', name: 'jackson-dataformat-yaml', version: '2.9.8'
	compile group: 'com.fasterxml.jackson.dataformat', name: 'jackson-dataformat-xml', version: '2.9.8'
	
	compile 'org.codehaus.groovy:groovy:2.4.14'
	
//	for the jasper to work, need to add a new maven repo to nexus: http://jaspersoft.artifactoryonline.com/jaspersoft/third-party-ce-artifacts/
	//  refer to this post for more details: http://community.jaspersoft.com/questions/826431/failure-find-orgolap4jolap4jjar097309-js-3, ,
	compile 'net.sf.jasperreports:jasperreports:6.5.1'
	compile 'net.sf.jasperreports:jasperreports-fonts:6.0.0'
	
	compile 'org.mozilla:rhino:1.7.9'
	
	compile 'net.java.dev.jna:jna:4.5.1'
	compile 'net.java.dev.jna:jna-platform:4.5.1'
	compile 'org.jsoup:jsoup:1.11.2'
	compile 'org.coconut.forkjoin:jsr166y:281207'
	compile 'com.sun.mail:javax.mail:1.6.1'
	compile 'org.apache.pdfbox:pdfbox:2.0.8'
	compile 'org.apache.poi:poi:3.17'
	compile 'org.apache.poi:poi-excelant:3.17'
	compile 'org.apache.poi:poi-ooxml:3.17'
	compile 'org.apache.poi:poi-ooxml-schemas:3.17'
	compile 'org.apache.poi:poi-scratchpad:3.17'
	compile 'org.scala-lang:scala-compiler:2.10.7'
	compile 'org.scala-lang:scala-swing:2.10.7'
	compile 'org.scala-lang:scala-library:2.10.7'
	compile 'org.scala-lang:scala-partest:2.10.7'
	compile 'org.scala-lang:scala-dbc:2.9.3'
	compile 'org.scalacheck:scalacheck_2.10:1.13.5'
	compile 'org.scala-lang:scalap:2.10.7'
	compile 'javax.servlet:javax.servlet-api:3.1.0'
	
	compile 'mysql:mysql-connector-java:5.1.46'
	compile 'com.microsoft.sqlserver:mssql-jdbc:6.4.0.jre8'
	compile 'com.h2database:h2:1.4.197'

	// HAPI (HL7)
	compile group: 'ca.uhn.hapi', name: 'hapi-base', version: '2.3'
	compile group: 'ca.uhn.hapi', name: 'hapi-structures-v251', version: '2.3'
	compile group: 'ca.uhn.hapi', name: 'hapi-structures-v25', version: '2.3'
	compile group: 'ca.uhn.hapi', name: 'hapi-structures-v231', version: '2.3'
	compile group: 'ca.uhn.hapi', name: 'hapi-structures-v23', version: '2.3'
	//hapi fhir support
    compile 'ca.uhn.hapi.fhir:hapi-fhir-jpaserver-base:4.2.0'
    compile 'ca.uhn.hapi.fhir:hapi-fhir-client-okhttp:4.2.0'
    compile 'ca.uhn.hapi.fhir:hapi-fhir-jaxrsserver-base:4.2.0'	
	compile group: 'ca.uhn.hapi.fhir', name: 'hapi-fhir-server', version: '4.2.0'
	compile group: 'ca.uhn.hapi.fhir', name: 'hapi-fhir-validation', version: '4.2.0'
	compile group: 'ca.uhn.hapi.fhir', name: 'hapi-fhir-base', version: '4.2.0'
}


test {
    testLogging {
        showStandardStreams = true
    }
}

jar {
    archiveName fName + '.jar'
    manifest {
      attributes('Manifest-Version': '1.0',
        'Created-By': 'Sunquest Information Systems',
          'Implementation-Title': 'Mitogen LIMS',
        'Implementation-Version': versionBuild,
        'Main-Class': 'com.sunquest.mitogen.lims.RunUniflow',
        'One-Jar-Main-Class': 'com.sunquest.mitogen.lims.RunUniflow',
        'One-Jar-Expand-Dir': '.',
        'Implementation-Vendor': 'Sunquest Information Systems',
        'Confidential': 'This is confidential information of Sunquest Information Systems, Inc.'
        )
   }   
}


task dist(type: Zip) {
    dependsOn jar
    group 'Build'
    description 'Assemble a zip file containing jar and dependency jars and other project artifacts for distribution'
    archiveName fName + '.zip'

    from(configurations.runtime) {
           into(distDest + '/lib')
       }
    from('config') {
        into(distDest + '/config')
    }
    from('public') {
        into(distDest + '/public')
    }
    from('private') {
        into(distDest + '/private')
    }

    from('bin') { 
        include 'install.sh'
        include 'setup.sh'
        include 'simple_start.sh'
        include 'versionupdate.ps1'
        into(distDest + '/bin')
    }

    from('./') {
        include '*.xml'
        include 'tableDefs.ixml'
        into(distDest)
    }

    from('./bin/install.sh') {
        into(distDest)
    }


    from('data') {
        exclude 'dbUpgrade.py'
        exclude 'update_template.txt'
        exclude 'config.json'
        into(distDest + '/data');
    }

    from('./') {
        include 'uniflow*/**'
        exclude 'uniflow*.zip'
        into(distDest)
    }

    from(jar) {
        into(distDest)
    }

}




