#------------------------------------------------------------------------##                            UNIconnect LC                               ##                 UNIFLOW Demonstration Process Definition               ##                       CONFIDENTIAL INFORMATION                         ##        Copyright (C) 2001-2016 UNIConnect LC.  All rights reserved.    ##------------------------------------------------------------------------#config  steps    stepGroup User Admin    step Add User      accessLevel 10      form        data-parsley-validate=        include userAccountInfo        include stepInstructions        vertical          fieldset            legend Explanation              class= legend            vertical              li Use this step to create internal users.              li To create an external Portal User, use the People step instead.              li To create or change Account Ids contact a UNIConnect Process Engineer              li Access Level can restrict access to steps as defined:              span 2 is for external users.  6 is default and typical for lab employees.              span 8 for lab supervisors.   10 for system administrators.          text _dummy            screenLabel~            style= display:none;            value= -1        vertical          text User Id            screenLabel~ User ID            validate~ ! select userId from userInfo where userId = '{_thisInput}'              errorMessage~ This User ID already exists.  Please enter a new User ID.            required~ true            class= required            data-parsley-required= true          password_input Password            autocomplete= off            required~ true            class= required            data-parsley-required= true          text Name          text Email            type= email          text Phone            placeholder= ###-###-####          number Access Level            value= 6            min~ 2            max~ 10            numeric~            data-parsley-type= integer          select Account Id            option            sqlQuery~ select distinct accountId              - from userInfo              - where (accountId not like 'chpwd%' and userId <> '4bc24939ff98dbb663'              - and accountId <> 'MITOGEN' and accountId <> 'UNICONNECT')          comments Comments      sqlPreparedStatement insert into userInfo (userId,password,name,accessLevel,accountId,email,userProfile,phone,active,eventId)        - values (?,'tmppw',?,?,?,?        -   ,'userProfile\n  webApps \n    webapp /uniflow\n      userStepGroups \n        stepGroup Users\n'        -   ,?,'true',?)        string {User Id}        string {Name}        long {Access Level}        string chpwd{Account Id}        string {Email}        string {Phone}        long {_eventId}      execClassMethod uniflow.Switchboard.changePassword    step Set Password Strength Requirements      accessLevel 10      form        include userAccountInfo        include stepInstructions        vertical          number minLength            screenLabel~ Minimum Password Length            required~          checkbox bothCases            screenLabel~ Password must contain both lower and uppercase characters.          checkbox numbers            screenLabel~ Password must contain both numbers and letters.          checkbox specialCharacters            screenLabel~ Password must contain at least one special character.      sqlPreparedStatement delete from passwordStrength      sqlPreparedStatement insert into passwordStrength (eventId, minLength, bothCases, numbers, specialCharacters)        - values (?, ?, ?, ?, ?)        long {_eventId}        long {minLength}        string {bothCases}        string {numbers}        string {specialCharacters}    step Set PIN      form        include stepInstructions        vertical          text userId            value= {_userId}            readonly=            screenLabel~ Current User Id:        vertical          userPIN myPIN            screenLabel~ Please enter a PIN            updatePIN~    step Change User Status      accessLevel 10      form        include userAccountInfo        include stepInstructions        fieldset          style= background-color:white;          legend Explanation            class= legend          span Get a list of all users belonging to selected account        vertical          select Account Id            option            option              value= {_accountId}              selected=            sqlQuery~ select distinct accountId from userInfo where userId <> '4bc24939ff98dbb663' and accountId <> 'MITOGEN' and accountId not like 'chpwd%' and accountId <> 'UNICONNECT'              - order by accountId      form        include userAccountInfo        include stepInstructions        hidden Account Id          value= {Account Id}        table          sqlQuery~ select u.userId,u.name,u.accessLevel,u.accountId,u.active,u.failedLoginAttempts 'attempts'            - ,'' as 'Update'            - from userInfo u            - where u.accountId like '%{Account Id}%' and u.userId <> '4bc24939ff98dbb663' and u.accountId <> 'MITOGEN' and u.accountId <> 'chpwdMITOGEN' and u.accountId <> 'UNICONNECT' and u.accountId <> 'chpwdUNICONNECT' and u.accessLevel <= 10            - order by name          columnSpecs~ AccountTable            allowChangedRecordIds            column 1              inputType text                style= width: 200px;                readonly=                class= readonly-input            column 2              inputType text            column 3              inputType number                min~ 2                max~ 10            column 4              inputType text            column 5              inputType select                option true                option false            column 7              inputType checkbox      forRows AccountTable        ifCondition {_columnInput_AccountTable:7}          advanced~          equals~ true          sqlPreparedStatement update userInfo set            - name = ?            - ,accessLevel = ?            - ,accountId = ?            - ,active = ?            - ,failedLoginAttempts = 0            - where userId = ?            string {_columnInput_AccountTable:2}            long {_columnInput_AccountTable:3}            string {_columnInput_AccountTable:4}            string {_columnInput_AccountTable:5}            string {_columnInput_AccountTable:1}    step Reset User Password      accessLevel 10      form        include userAccountInfo        include stepInstructions        vertical          select User Id            sqlQuery~ select userId from userInfo where userId <> '4bc24939ff98dbb663' and accountId <> 'MITOGEN' and accountId <> 'chpwdMITOGEN' and accountId <> 'UNICONNECT' and accountId <> 'chpwdUNICONNECT' order by userId          password_input New Password            autocomplete= off            required~ true          password_input Confirm New Password            autocomplete= off            validate~ select * from sequences where '{New Password}' = '{Confirm New Password}'              errorMessage~ Passwords do not match      sqlPreparedStatement insert into containerHistory (containerId, eventId)        - values (?, ?)        string {User Id}        long {_eventId}      sqlPreparedStatement update userInfo set accountId = concat('chpwd',accountId) where userId = ?        string {User Id}      execClassMethod uniflow.Switchboard.changePassword    step List Users      accessLevel 10      form        include userAccountInfo        include stepInstructions        table          id= myTable          class= stdTableSort          caption Users          sqlQuery~ select userId, name, accessLevel, accountId, email, phone, active from userInfo where userId <> '4bc24939ff98dbb663' and accountId <> 'MITOGEN' and accountId <> 'UNICONNECT'  and accessLevel <= 10 order by userId    step View Login History      accessLevel 10      form        include userAccountInfo        include stepInstructions        table          id= myTable          sqlQuery~ SELECT lh.* FROM loginHistory lh inner join userInfo ui on lh.userId = ui.userId where ui.userId <> '4bc24939ff98dbb663' and ui.accountId <> 'MITOGEN' and ui.accountId <> 'UNICONNECT' and ui.accessLevel <= 10 order by eventDate desc limit 100          class= stdTableSort##SUPER USER STEPS    step Super Add User      accessLevel 12      authorizedGroup MITOGEN      form        include userAccountInfo        include stepInstructions        vertical          fieldset            legend Explanation              class= legend            vertical              li Use this step to create internal users.              li To create an external Portal User, use the People step instead.              li To create or change Account Ids contact a UNIConnect Process Engineer              li Access Level can restrict access to steps as defined:              span 2 is for external users.  6 is default and typical for lab employees.              span 8 for lab supervisors.   10 for system administrators.              span 12 for Mitogen LIMS Developers.          text _dummy            screenLabel~            style= display:none;            value= -1        vertical          text User Id            sqlField~ userId          password_input Password            autocomplete= off            required~ true          text Name            sqlField~ name          text Email            sqlField~ email          text Phone            sqlField~ phone          number Access Level            sqlField~ accessLevel            value= 6            numeric~          select Account Id            option            sqlQuery~ select distinct accountId from userInfo where accountId not like 'chpwd%' and userId <> '4bc24939ff98dbb663' and accountId <> 'UNICONNECT'            sqlField~ accountId          comments Comments      sqlPreparedStatement insert into userInfo (userId,password,name,accessLevel,accountId,email,userProfile,phone,active,eventId)        - values (?,'tmppw',?,?,?,?        -   ,'userProfile\n  webApps \n    webapp /uniflow\n      userStepGroups \n        stepGroup Users\n'        -   ,?,'true',?)        string {User Id}        string {Name}        long {Access Level}        string chpwd{Account Id}        string {Email}        string {Phone}        long {_eventId}      execClassMethod uniflow.Switchboard.changePassword    step Super Change User Status      accessLevel 12      authorizedGroup MITOGEN      form        include userAccountInfo        include stepInstructions        fieldset          style= background-color:white;          legend Explanation            class= legend          span Get a list of all users belonging to selected account        vertical          select Account Id            option            option              value= {_accountId}              selected=            sqlQuery~ select distinct accountId from userInfo where userId <> '4bc24939ff98dbb663' and accountId not like 'chpwd%'              - order by accountId      form        include userAccountInfo        include stepInstructions        hidden Account Id          value= {Account Id}        table          sqlQuery~ select u.userId,u.name,u.accessLevel,u.accountId,u.active,u.failedLoginAttempts 'attempts'            - ,'' as 'Update'            - from userInfo u            - where u.accountId like '%{Account Id}%' and u.userId <> '4bc24939ff98dbb663'            - order by name          columnSpecs~ AccountTable            allowChangedRecordIds            column 1              inputType text                style= width: 200px;                readonly=                class= readonly-input            column 2              inputType text            column 3              inputType number                min~ 2                max~ 14            column 4              inputType text            column 5              inputType select                option true                option false            column 7              inputType checkbox      forRows AccountTable        ifCondition {_columnInput_AccountTable:7}          advanced~          equals~ true          sqlPreparedStatement update userInfo set            - name = ?            - ,accessLevel = ?            - ,accountId = ?            - ,active = ?            - ,failedLoginAttempts = 0            - where userId = ?            string {_columnInput_AccountTable:2}            long {_columnInput_AccountTable:3}            string {_columnInput_AccountTable:4}            string {_columnInput_AccountTable:5}            string {_columnInput_AccountTable:1}    step Super Reset User Password      accessLevel 12      authorizedGroup MITOGEN      form        include userAccountInfo        include stepInstructions        vertical          select User Id            sqlQuery~ select userId from userInfo where userId <> '4bc24939ff98dbb663' order by userId          password_input New Password            autocomplete= off            required~ true          password_input Confirm New Password            autocomplete= off            validate~ select * from sequences where '{New Password}' = '{Confirm New Password}'              errorMessage~ Passwords do not match      sqlPreparedStatement insert into containerHistory (containerId, eventId) values (?, ?)        string {User Id}        long {_eventId}      sqlPreparedStatement update userInfo set accountId = concat('chpwd',accountId) where userId = ?        string {User Id}      execClassMethod uniflow.Switchboard.changePassword    step Super List Users      accessLevel 12      authorizedGroup MITOGEN      form        include userAccountInfo        include stepInstructions        table          id= myTable          class= stdTableSort          caption Users          sqlQuery~ select userId, name, accessLevel, accountId, email, phone, active from userInfo where userId <> '4bc24939ff98dbb663' order by userId    step Super View Login History      accessLevel 12      authorizedGroup MITOGEN      form        include userAccountInfo        include stepInstructions        table          id= myTable          sqlQuery~ SELECT * FROM loginHistory order by eventDate desc limit 100          class= stdTableSort    stepGroup Users    step Change Your Contact Info      accessLevel 1      form        include userAccountInfo        include stepInstructions        formQuery~ select email, phone from userInfo where userId = '{_userId}'        vertical          text Email            value= {_resultSet:email}            size= 50          text Phone            value= {_resultSet:phone}            size= 50      sqlPreparedStatement update userInfo set email = ?, phone = ? where userId = ?        string {Email}        string {Phone}        string {_userId}    step Change Your Password      nextStep LOGOUT        formNumber 0      accessLevel 1      form        include userAccountInfo        include stepInstructions        script          - $(document).ready(function(){          -   var goodPassword= 0;          -   var minLength= $('#minLength').val();          -   var bothCases= $('#bothCases').val();          -   var numbers= $('#numbers').val();          -   var specialCharacters= $('#specialCharacters').val();          -   var alertMessage= "";          -   $('#stepFormSubmitButton').remove();          -   $('#logout').click(function(){          -     if ($('#pwd').val().length == 0) {          -       alertMessage = alertMessage.replace('You cannot leave the password field blank! \n', '');          -       alertMessage += "You cannot leave the password field blank! \n";          -     } else { alertMessage = alertMessage.replace('You cannot leave the password field blank! \n', ''); }          -     if ($('#pwd').val() != $('#pwd2').val()) {          -       alertMessage = alertMessage.replace('Your password confirmation does not match. \n', '');          -       alertMessage += "Your password confirmation does not match. \n";          -     }          -     else { alertMessage = alertMessage.replace('Your password confirmation does not match. \n', ''); }          -     if ($('#pwd').val().length < minLength) {          -       alertMessage = alertMessage.replace('Your password is too short. \n', '');          -       alertMessage += "Your password is too short. \n";          -     }          -     else { alertMessage = alertMessage.replace('Your password is too short. \n', ''); }          -     if (bothCases == 'true') {          -       if ($('#pwd').val().match(/([a-z].*[A-Z])|([A-Z].*[a-z])/)) {          -         alertMessage = alertMessage.replace('Password must contain at least one lowercase and one uppercase letter. \n', '');          -       } else {          -         alertMessage = alertMessage.replace('Password must contain at least one lowercase and one uppercase letter. \n', '');          -         alertMessage += "Password must contain at least one lowercase and one uppercase letter. \n";          -       }          -     }          -     if (numbers == 'true') {          -       if ($('#pwd').val().match(/([a-zA-Z])/) && $('#pwd').val().match(/([0-9])/)) {          -         alertMessage = alertMessage.replace('Password must contain at least one number. \n', '');          -       } else {          -         alertMessage = alertMessage.replace('Password must contain at least one number. \n', '');          -         alertMessage += "Password must contain at least one number. \n";          -       }          -     }          -     if (specialCharacters == 'true') {          -       if ($('#pwd').val().match(/([!,%,&,@,#,$,^,*,?,_,~])/)) {          -         alertMessage = alertMessage.replace('Password must contain at least one special character. \n', '');          -       } else {          -         alertMessage = alertMessage.replace('Password must contain at least one special character. \n', '');          -         alertMessage += "Password must contain at least one special character. \n";          -       }          -     }          -     if (alertMessage == '') {          -       $('form').submit();          -     } else { alert(alertMessage) }          -   });          - });        formQuery          - select          -   minLength          -   , bothCases          -   , numbers          -   , specialCharacters          - from passwordStrength          - union select '', '', '', ''        fieldset          legend Instructions          ol            li Never share your password with anyone.            li Change your password whenever a new password is given to you.            li Do not write your password down and leave it in your work area.            li If your password is compromised, report the situation to your supervisor and change the password immediately.            li If you forget your password, ask your system administrator for a new one.        fieldset          legend Password Requirements          vertical            text minLength              screenLabel~ Minimum password length:              value= {_:minLength}              id= minLength              readonly= true            text bothCases              screenLabel~ Uppercase and lowercase required:              value= {_:bothCases}              id= bothCases              readonly= true            text numbers              screenLabel~ At least one number required:              value= {_:numbers}              id= numbers              readonly= true            text specialCharacters              screenLabel~ Special characters required:              value= {_:specialCharacters}              id= specialCharacters              readonly= true        vertical          password_input New Password            autocomplete= off            id= pwd            required~ true          password_input Confirm New Password            autocomplete= off            id= pwd2            validate~ select * from sequences where '{New Password}' = '{Confirm New Password}'              errorMessage~ Passwords do not match            validate~ select 1 from dual where LENGTH('{New Password}') >= '{minLength}'              errorMessage~ Password is too short          button Update Password            id= logout      sqlPreparedStatement update userInfo set accountId = replace(accountId,'chpwd','') where userId = ?        string {_userId}      execClassMethod uniflow.Switchboard.changePassword    stepGroup UsersHidden    step LOGOUT      accessLevel 1      form        script          - $(document).ready(function() {          -   window.open('/uniflow?logout=logout','_self');          - });