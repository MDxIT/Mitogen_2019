config  steps    stepGroup Tests###### TESTS ###############################################################################    step Tests      queueSelectRecId      accessLevel 10      form        include stepInstructions        script          src= js/testsAndPanels/tests_f0.js        hidden _dummy        div          class= pageSection          div            class= sectionTitle            span Instructions          div            class= sectionContent            vertical              li Click 'Create New' to create a new record.              li Click on the link to view or modify record.        br        div          class= pageSection          div            class= sectionTitle            span Current Tests          div            class= sectionContent            table              class= stdTableBasic              sqlPreparedQuery~                - SELECT                -   testCode as "Test Code Id",                -   name AS "Name",                -   abbreviation "Abbreviation",                -   CASE disabled                -     WHEN 0 THEN 'enabled'                -     ELSE 'disabled'                -   END AS "Status",                -   type AS "Type"                - FROM tests                - ORDER BY type, name, testCode      form        include stepInstructions        data-parsley-validate= true        script          src= js/niceedit/nicEdit.js        script          src= js/testsAndPanels/tests_f1.js        include userAccountInfo        formPreparedQuery~          - SELECT          -   testCode,          -   name,          -   abbreviation,          -   description,          -   disabled,          -   type,          -   cptCode AS "cptCode",          -   zCode AS "zCode",          -   billingCode AS "billingCode"          - FROM tests          - WHERE testCode = ?          - UNION          - SELECT 'NEW', '', '', '', '0', '', '', '', ''          string {_recId}        hidden tests_isNew          value= {_:testCode}          id= tests_isNew        hidden sequenceName          value= tests          id= tests_sequenceName        hidden _recId          value= {_recId}        div          id= tabs          ul            li              a Info                href= #info            li              a Report Wording                href= #assayWording            li              a Report References                href= #reportReferences          div            id= info            div              class= pageSection              div                class= sectionTitle                span Info              div                class= sectionContent                div                  class= horizontalFlex                  div                    class= verticalFlex                    label Test Code                    text tests_testCode                      id= tests_testCode                      class= required                      data-parsley-required= true                      required~ true                      value= {_recId}                      validate~ SELECT 1                        - FROM dual                        - WHERE (NOT EXISTS (SELECT 1                        -                   FROM tests                        -                   WHERE testCode = '{_thisInput}')                        -       AND '{tests_isNew}' = 'NEW')                        - OR '{tests_isNew}' <> 'NEW'                        errorMessage~ The test code must be unique. This test code already exists in the system.                    button tests_makeSystemId                      value= Generate Test Code                      id= tests_makeSystemId                div                  class= verticalFlex                  label Name                  text tests_name                    id= tests_name                    class= required width300px                    data-parsley-required= true                    required~ true                    value= {_:name}                    validate~ SELECT 1                      - FROM dual                      - WHERE (NOT EXISTS (SELECT 1                      -                   FROM tests                      -                   WHERE name = '{_thisInput}')                      -       AND '{tests_isNew}' = 'NEW')                      - OR '{tests_isNew}' <> 'NEW'                      errorMessage~ The test name must be unique. This test name already exists in the system.                  label Abbreviation                  text tests_abbreviation                    id= tests_abbreviation                    class= required width300px                    data-parsley-required= true                    required~ true                    value= {_:abbreviation}                    validate~ SELECT 1                      - FROM dual                      - WHERE (NOT EXISTS (SELECT 1                      -                   FROM tests                      -                   WHERE abbreviation = '{_thisInput}')                      -       AND '{tests_isNew}' = 'NEW')                      - OR '{tests_isNew}' <> 'NEW'                      errorMessage~ The abbreviation must be unique. This abbreviation already exists in the system.                  label Status                  select tests_disabled                    class= required                    data-parsley-required= true                    setName~ status                    value= {_:disabled}                    title= SETNAME:status                  label Type                  select tests_type                    id= tests_testType                    class= required                    data-parsley-required= true                    setName~ workflows                    value= {_:type}                    title= SETNAME:workflows                  label CPT Code                  text cptCode                    id= cptCode                    value= {_:cptCode}                  label Z Code                  text zCode                    id= zCode                    value= {_:zCode}                  label Billing Code                  text billingCode                    id= billingCode                    value= {_:billingCode}                  label Description                  textArea tests_description                    id= tests_description                    value= {_resultSet:description}                    style= width:500px;            br            div              class= pageSection              div                class= sectionTitle                span Current Panel Links              div                class= sectionContent tests_inPanels                table                  sqlPreparedQuery~                    - SELECT                    -   p.panelCode as "Panel Code",                    -   p.name as "Name",                    -   p.type as "Type",                    -   v.displayValue as "Status"                    - FROM testPanels tp                    - INNER JOIN panels p                    - ON tp.panelCode = p.panelCode                    - INNER JOIN validValues v                    - ON p.disabled = v.value                    - WHERE tp.testCode = '{_recId}'                    - AND v.setName = 'status'          div            id= assayWording            include assayWordingTable              parameter~ type                value= Test              parameter~ codeName                value= {_recId}          div            id= reportReferences            include assayReferences              parameter~ type                value= Test              parameter~ codeName                value= {_recId}      ifCondition {tests_isNew}        advanced~        equals~ NEW        sqlPreparedStatement~          - INSERT INTO tests (testCode, name, description, abbreviation, type, disabled, cptCode, zCode, billingCode, eventId)          - VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?)          string {tests_testCode}          string {tests_name}          string {tests_description}          string {tests_abbreviation}          string {tests_type}          int {tests_disabled}          string {cptCode}          string {zCode}          string {billingCode}          long {_eventId}        else          sqlPreparedStatement~            - UPDATE tests            - SET name = ?,            -     description = ?,            -     abbreviation = ?,            -     type = ?,            -     disabled = ?,            -     cptCode = ?,            -     zCode = ?,            -     billingCode = ?,            -     eventId = ?            - WHERE testCode = ?            string {tests_name}            string {tests_description}            string {tests_abbreviation}            string {tests_type}            int {tests_disabled}            string {cptCode}            string {zCode}            string {billingCode}            long {_eventId}            string {tests_testCode}      include assayWordingSql        parameter~ type          value= Test        parameter~ codeName          value= {tests_testCode}      include assayReferencesSql        parameter~ type          value= Test        parameter~ codeName          value= {tests_testCode}###### PANELS ##############################################################################    step Panels      accessLevel 10      form        include stepInstructions        script          src= js/testsAndPanels/tests_f0.js        hidden _dummy        div          class= pageSection          div            class= sectionTitle            span Instructions          div            class= sectionContent            vertical              li Click 'Create New' to create a new record.              li Click on the link to view or modify record.        br        div          class= pageSection          div            class= sectionTitle            span Current Panels          div            class= sectionContent            table              class= stdTableBasic              sqlPreparedQuery~                - SELECT                -   panelCode AS "Panel Code Id",                -   name AS "Name",                -   abbreviation AS "Abbreviation",                -   type AS "Type",                -   CASE disabled                -     WHEN 0 THEN 'enabled'                -     ELSE 'disabled'                -   END AS "Status"                - from panels                - order by Type, Name      form        include stepInstructions        data-parsley-validate= true        script          src= js/niceedit/nicEdit.js        script          src= js/genes.utilities.js        script          src= js/testsAndPanels/tests_f1.js        script          src= js/testsAndPanels/panels_f1.js        formPreparedQuery~          - SELECT          -   panelCode,          -   name,          -   abbreviation,          -   description,          -   disabled,          -   type,          -   genes,          -   CASE isCustomGenePanel          -     WHEN 0 THEN 'false'          -     ELSE 'true'          -   END AS "isCustomGenePanel"          - FROM panels          - WHERE panelCode = ?          - UNION          - SELECT 'NEW', '', '', '', 0, '', '', 'false'          string {_recId}        hidden tests_isNew          value= {_:panelCode}          id= tests_isNew        hidden sequenceName          value= panels          id= tests_sequenceName        hidden _recId          value= {_recId}        div          id= itemsNotFoundDialog          style= display: none;        hidden genelistPass          id= genelistPass          value= true        div          id= tabs          ul            li              a Info                href= #info            li              a Report Wording                href= #assayWording            li              a Report References                href= #reportReferences          div            id= info            div              class= pageSection              div                class= sectionTitle                span Info              div                class= sectionContent                div                  class= horizontalFlex                  div                    class= verticalFlex                    label Panel Code                    text tests_testCode                      id= tests_testCode                      class= required width300px                      data-parsley-required= true                      required~ true                      value= {_recId}                      validate~ SELECT 1 FROM dual WHERE '{_thisInput}' <> ''                        errorMessage~ The panel code must be entered to submit.                      validate~ SELECT 1                        - FROM dual                        - WHERE (NOT EXISTS (SELECT 1                        -                   FROM panels                        -                   WHERE panelCode = '{_thisInput}')                        -       AND '{tests_isNew}' = 'NEW')                        - OR '{tests_isNew}' <> 'NEW'                        errorMessage~ The panel code must be unique. This panel code already exists in the system.                  div                    class= verticalFlex                    button tests_makeSystemId                      value= Generate Panel Code                      id= tests_makeSystemId                div                  class= verticalFlex                  label Name                  text tests_name                    id= tests_name                    class= required width300px                    data-parsley-required= true                    required~ true                    value= {_:name}                    validate~ SELECT 1 FROM dual WHERE '{_thisInput}' <> ''                      errorMessage~ The panel name must be entered to submit.                    validate~ SELECT 1                      - FROM dual                      - WHERE (NOT EXISTS (SELECT 1                      -                   FROM panels                      -                   WHERE name = '{_thisInput}')                      -       AND '{tests_isNew}' = 'NEW')                      - OR '{tests_isNew}' <> 'NEW'                      errorMessage~ The panel name must be unique. This panel name already exists in the system.                  label Abbreviation                  text tests_abbreviation                    id= tests_abbreviation                    class= required width300px                    data-parsley-required= true                    required~ true                    value= {_:abbreviation}                    validate~ SELECT 1                      - FROM dual                      - WHERE (NOT EXISTS (SELECT 1                      -                   FROM panels                      -                   WHERE abbreviation = '{_thisInput}')                      -       AND '{tests_isNew}' = 'NEW')                      - OR '{tests_isNew}' <> 'NEW'                      errorMessage~ The abbreviation must be unique. This abbreviation already exists in the system.                  label Status                  select tests_disabled                    setName~ status                    value= {_:disabled}                    title= SETNAME:status                    class= required                    data-parsley-required= true                    required~ true                  label Type                  select tests_type                    id= tests_testType                    setName~ workflows                    value= {_:type}                    title= SETNAME:workflows                    required~ false                  label Description                  textArea tests_description                    id= tests_description                    value= {_resultSet:description}                    style= width:500px;            br            div              class= pageSection              div                class= sectionTitle                span Panel Genes              div                class= sectionContent                div                  class= horizontalFlex-leftpadded                  label Custom Gene Panel?                  checkbox panels_isCustomGenePanel                    id= panels_isCustomGenePanel                    value= {_:isCustomGenePanel}                div                  class= verticalFlex                  id= panels_genesDiv                  label Gene List                  textArea panels_genes                    id= panels_genes                    value= {_resultSet:genes}                    style= width:500px;            br            div              class= pageSection              div                class= sectionTitle                span Tests in Panel              div                class= sectionContent                table                  sqlPreparedQuery~                    - SELECT                    -   'false' AS "Remove",                    -   t.abbreviation AS "Test Abbreviation",                    -   t.type AS "Type",                    -   t.testCode AS "Test Code"                    - FROM testPanels tp                    - INNER JOIN tests t                    - ON tp.testCode = t.testCode                    - WHERE tp.panelCode = '{_recId}'                  columnSpecs~ inPanel                    allowChangedRecordIds                    column 1                      inputType checkbox                    column 4                      inputType text                        readonly=            br            div              class= pageSection              div                class= sectionTitle                span Add Test(s) to Panel              div                class= sectionContent                table                  sqlPreparedQuery~                    - SELECT                    -   'false' AS "Add",                    -   t.abbreviation AS "Test Abbreviation",                    -   t.type AS "Type",                    -   t.testCode AS "Test Code"                    - FROM tests t                    - LEFT JOIN testPanels tp ON t.testCode = tp.testCode AND tp.panelCode = '{_recId}'                    - WHERE tp.testCode IS NULL                    -   AND t.disabled = 0                  columnSpecs~ addToPanel                    allowChangedRecordIds                    column 1                      inputType checkbox                    column 4                      inputType text                        readonly=          div            id= assayWording            include assayWordingTable              parameter~ type                value= Panel              parameter~ codeName                value= {_recId}          div            id= reportReferences            include assayReferences              parameter~ type                value= Panel              parameter~ codeName                value= {_recId}      ifCondition {tests_isNew}        advanced~        equals~ NEW        sqlPreparedStatement~          - INSERT INTO panels (panelCode, name, description, abbreviation, type, isCustomGenePanel, genes, disabled, eventId)          - VALUES (?,?,?,?,?,CASE ?          -                     WHEN 'true' THEN 1          -                     ELSE 0          -                   END,?,?,?)          string {tests_testCode}          string {tests_name}          string {tests_description}          string {tests_abbreviation}          string {tests_type}          string {panels_isCustomGenePanel}          string {panels_genes}          int {tests_disabled}          long {_eventId}        else          sqlPreparedStatement~            - UPDATE panels            - SET name = ?,            -     description = ?,            -     abbreviation = ?,            -     type = ?,            -     isCustomGenePanel = CASE ?            -                           WHEN 'true' THEN 1            -                           ELSE 0            -                         END,            -     genes = ?,            -     disabled = ?,            -     eventId = ?            - WHERE panelCode = ?            string {tests_name}            string {tests_description}            string {tests_abbreviation}            string {tests_type}            string {panels_isCustomGenePanel}            string {panels_genes}            int {tests_disabled}            long {_eventId}            string {tests_testCode}      forRows inPanel        ifCondition {_columnInput_inPanel:1}          advanced~          equals~ true          sqlPreparedStatement~            - DELETE FROM testPanels            - WHERE testCode = ?            - AND panelCode = ?            string {_columnInput_inPanel:4}            string {tests_testCode}      forRows addToPanel        ifCondition {_columnInput_addToPanel:1}          advanced~          equals~ true          sqlPreparedStatement~            - INSERT INTO testPanels (testCode, panelCode, eventId)            - VALUES (?,?,?)            string {_columnInput_addToPanel:4}            string {tests_testCode}            long {_eventId}      include assayWordingSql        parameter~ type          value= Panel        parameter~ codeName          value= {tests_testCode}      include assayReferencesSql        parameter~ type          value= Panel        parameter~ codeName          value= {tests_testCode}###### METHODS #############################################################################    step Methods      accessLevel 10      form        include stepInstructions        script          src= js/testsAndPanels/tests_f0.js        hidden _dummy        div          class= pageSection          div            class= sectionTitle            span Instructions          div            class= sectionContent            vertical              li Click 'Create New' to create a new record.              li Click on the link to view or modify record.        br        div          class= pageSection          div            class= sectionTitle            span Current Methods          div            class= sectionContent            table              class= stdTableBasic              sqlPreparedQuery~                - SELECT                -   m.methodCode AS "Method Code Id",                -   m.name AS "Name",                -   m.description AS "Method Description",                -   GROUP_CONCAT(DISTINCT                -     CONCAT(IFNULL(t.testCode,''),                -           CASE ISNULL(t.testCode)                -             WHEN 1 THEN ''                -             ELSE ': '                -           END,                -           IFNULL(t.name, ''))                -     ORDER BY IFNULL(t.name,'')                -     SEPARATOR '<br />') AS "Linked Tests",                -   CASE m.disabled                -     WHEN 0 THEN 'enabled'                -     ELSE 'disabled'                -   END AS "Status"                - FROM methods m                - LEFT JOIN testMethods tm                - ON m.methodCode = tm.methodCode                - LEFT JOIN tests t                - ON tm.testCode = t.testCode                - GROUP BY m.methodCode                - order by m.name      form        include stepInstructions        data-parsley-validate= true        script          src= js/niceedit/nicEdit.js        script          src= js/testsAndPanels/tests_f1.js        script          src= js/testsAndPanels/panels_f1.js        formPreparedQuery~          - SELECT          -   methodCode, name, description, disabled          - FROM methods          - WHERE methodCode = ?          - UNION          - SELECT 'NEW','','', 0          string {_recId}        hidden tests_isNew          value= {_:methodCode}          id= tests_isNew        hidden sequenceName          value= methods          id= tests_sequenceName        hidden recId          value= {_recId}        div          id= tabs          ul            li              a Info                href= #info            li              a Report Wording                href= #assayWording            li              a Report References                href= #reportReferences          div            id= info            div              class= pageSection              div                class= sectionTitle                span Info              div                class= sectionContent                div                  class= horizontalFlex                  div                    class= verticalFlex                    label Method Code                    text tests_testCode                      id= tests_testCode                      class= required width300px                      data-parsley-required= true                      required~ true                      value= {_recId}                      validate~ SELECT 1                        - FROM dual                        - WHERE (NOT EXISTS (SELECT 1                        -                   FROM methods                        -                   WHERE methodCode = ?)                        -       AND ? = 'NEW')                        - OR ? <> 'NEW'                        string {_thisInput}                        string {tests_isNew}                        string {tests_isNew}                        errorMessage~ The method code must be unique. This method code already exists in the system.                  div                    class= verticalFlex                    button tests_makeSystemId                      value= Generate Method Code                      id= tests_makeSystemId                div                  class= verticalFlex                  label Name                  text tests_name                    id= tests_name                    class= required width300px                    data-parsley-required= true                    required~ true                    value= {_:name}                    validate~ SELECT 1                      - FROM dual                      - WHERE (NOT EXISTS (SELECT 1                      -                   FROM methods                      -                   WHERE name = ?)                      -       AND ? = 'NEW')                      - OR ? <> 'NEW'                      string {_thisInput}                      string {tests_isNew}                      string {tests_isNew}                      errorMessage~ Method name must be unique.                  label Description                  textArea tests_description                    id= tests_description                    value= {_:description}                    style= width:500px;                  label Status                  select tests_disabled                    setName~ status                    value= {_:disabled}                    title= SETNAME:status            br            div              class= pageSection              div                class= sectionTitle                span Linked Tests              div                class= sectionContent                table                  sqlPreparedQuery~                    - SELECT                    -   'false' AS "Remove",                    -   t.abbreviation AS "Test Abbreviation",                    -   t.type AS "Type",                    -   t.testCode AS "Test Code"                    - FROM testMethods tm                    - INNER JOIN tests t                    - ON tm.testCode = t.testCode                    - WHERE tm.methodCode = '{_recId}'                  columnSpecs~ testMethods                    allowChangedRecordIds                    column 1                      inputType checkbox                    column 4                      inputType text                        readonly=            br            div              class= pageSection              div                class= sectionTitle                span Link Test(s) to Method              div                class= sectionContent                table                  sqlPreparedQuery~                    - SELECT                    -   'false' AS "Add",                    -   t.abbreviation AS "Test Abbreviation",                    -   t.type AS "Type",                    -   t.testCode AS "Test Code"                    - FROM tests t                    - LEFT JOIN testMethods tm ON t.testCode = tm.testCode AND tm.methodCode = '{_recId}'                    - WHERE tm.testCode IS NULL                    -   AND t.disabled = 0                  columnSpecs~ linkToMethod                    allowChangedRecordIds                    column 1                      inputType checkbox                    column 4                      inputType text                        readonly=          div            id= assayWording            include assayWordingTable              parameter~ type                value= Method              parameter~ codeName                value= {_recId}          div            id= reportReferences            include assayReferences              parameter~ type                value= Method              parameter~ codeName                value= {_recId}      ifCondition {tests_isNew}        advanced~        equals~ NEW        sqlPreparedStatement~          - INSERT INTO methods (methodCode, name, description, disabled, eventId)          - VALUES (?,?,?,?,?)          string {tests_testCode}          string {tests_name}          string {tests_description}          int {tests_disabled}          long {_eventId}        else          sqlPreparedStatement~            - UPDATE methods            - SET name = ?,            -     description = ?,            -     disabled = ?,            -     eventId = ?            - WHERE methodCode = ?            string {tests_name}            string {tests_description}            int {tests_disabled}            long {_eventId}            string {tests_testCode}      forRows testMethods        ifCondition {_columnInput_testMethods:1}          advanced~          equals~ true          sqlPreparedStatement~            - DELETE FROM testMethods            - WHERE testCode = ?            - AND methodCode = ?            string {_columnInput_testMethods:4}            string {tests_testCode}      forRows linkToMethod        ifCondition {_columnInput_linkToMethod:1}          advanced~          equals~ true          sqlPreparedStatement~            - INSERT INTO testMethods (testCode, methodCode, eventId)            - VALUES (?,?,?)            string {_columnInput_linkToMethod:4}            string {tests_testCode}            long {_eventId}      include assayWordingSql        parameter~ type          value= Method        parameter~ codeName          value= {tests_testCode}      include assayReferencesSql        parameter~ type          value= Method        parameter~ codeName          value= {tests_testCode}###### DRUGS ###############################################################################    step Drugs      accessLevel 10      jsScripts        src js/testsAndPanels/drugs.js      form        include stepInstructions        include userAccountInfo        div          class= pageSection          div            class= sectionTitle            span Instructions          div            class= sectionContent            vertical              li Click 'Create New' to create a new record.              li Click on the link to view or modify record.        br        div          class= pageSection          div            class= sectionTitle            span Current Drugs          div            class= sectionContent            table              class= stdTableBasic drugTable              id= drugTable              sqlPreparedQuery~                - SELECT                -   CONCAT('<a href="/uniflow?lastForm=Y&stepName=Drugs&recId=',id,'">',name,'</a>') AS 'Name',                -   abbreviation AS 'Abbreviation',                -   CASE WHEN disabled = 0 THEN 'enabled' ELSE 'disabled' END AS 'Status'                - FROM drugs                - ORDER BY name      form        data-parsley-validate=        formPreparedQuery~          - SELECT          -   d.id,          -   d.name,          -   d.abbreviation,          -   d.disabled,          -   v.displayValue          -   FROM drugs d          -     INNER JOIN validValues v ON d.disabled = v.value          -       AND setName = 'status'          -   WHERE d.id = ?          string {_recId}          allowEmptyResults~        hidden drugId          value= {_:id}        hidden orginalDrugName          value= {_:name}        vertical          text drugName            screenLabel~ Drug Name            id= drugName            value= {_:name}            data-parsley-required= true            class= required            validate~ ! select name from drugs where name = ? and name <> ?              string {_thisInput}              string {orginalDrugName}              errorMessage~ This Drug Name already exists          text abbreviation            screenLabel~ Abbreviation            id= abbreviation            value= {_:abbreviation}          select disabled            data-parsley-required= true            class= required            screenLabel~ Status            setName~ status            value= {_:disabled}            title: SETNAME:status      ifCondition {drugId}        advanced~        isBlank~        sqlPreparedStatement          - INSERT INTO drugs(name,abbreviation,disabled,eventId)          - VALUES (?,?,?,?)          string {drugName}          string {abbreviation}          int {disabled}          long {_eventId}        else          sqlPreparedStatement            - UPDATE drugs            -   SET name = ?,            -   abbreviation = ?,            -   disabled = ?            - WHERE id = ?            string {drugName}            string {abbreviation}            long {disabled}            long {drugId}      ## FUTURE USER STORY        # fieldset        #   legend Assign Analyte to Drug        #     onclick= $('#new').toggle();        #   div        #     id= new        #     table        #       id= myTable        #       class= stdTableBasic        #       sqlPreparedQuery~        #         - SELECT DISTINCT        #         -   CASE WHEN al.analyteId THEN 'true' END AS 'Add',        #         -   a.analyteGroup 'Group',        #         -   a.name 'Name',        #         -   a.abbreviation 'Abbreviation',        #         -   a.Id as 'Analyte Id'        #         - FROM analytes a        #         -   LEFT JOIN analyteLinks al ON al.analyteId = a.Id AND al.linkId = ?        #         -     AND al.linkType = 'Drug'        #         - ORDER BY analyteGroup,name        #         string {_recId}        #       columnSpecs~ assignAnalyte        #         allowChangedRecordIds        #         column 1        #           data-orderable= false        #           inputType checkbox        #         column 5        #           inputType text        #             numeric~        #             readonly=        #             style= border: none;        # forRows assignAnalyte        #   ifCondition {_columnInput_assignAnalyte:1}        #      advanced~        #      equals~ false        #     sqlPreparedStatement        #       - DELETE FROM analyteLinks        #       - WHERE linkId = ?        #       - AND analyteId = ?        #       - AND linkType = 'Drug'        #       long {Id}        #       long {_columnInput_assignAnalyte:5}        #   ifCondition {_columnInput_assignAnalyte:1}        #      advanced~        #      equals~ true        #     sqlPreparedStatement        #       - INSERT IGNORE INTO analyteLinks (analyteId,linkId,linkType,eventId)        #       - VALUES( ?,?,'Drug',?)        #       long {_columnInput_assignAnalyte:5}        #       long {Id}        #       long {_eventId}        ### for new drug        # forEach SELECT {_getNextSequence:drugId} AS 'drugId'        #   - FROM DUAL WHERE CAST('{Id}' AS signed) = CAST('-1' AS signed)        #   sqlPreparedStatement        #     - INSERT INTO drugs (Id,eventId)        #     - VALUES (cast(? AS unsigned),?)        #     long {_resultSet:drugId}        #     long {_eventId}        # forEach SELECT {_getNextSequence:testId} AS 'testId'        #   - FROM DUAL WHERE CAST('{Id}' AS signed) = CAST('-1' AS signed)        #   sqlPreparedStatement        #     - INSERT INTO tests (Id,eventId)        #     - VALUES (cast(? AS unsigned),?)        #     long {_:testId}        #     long {_eventId}        ### for new drug        # ifCondition        #    advanced~        #    sqlPreparedQuery~ SELECT 1        #      - FROM DUAL        #      - WHERE CAST('{Id}' AS signed) = CAST('-1' AS signed)        #   sqlPreparedStatement        #     - UPDATE drugs        #     -   SET name = ?,        #     -   abbreviation = ?,        #     -   testId = ?,        #     -   disabled = cast(? as unsigned)        #     - WHERE drugId = ?        #     string {drugName}        #     string {abbreviation}        #     long {_:testId}        #     long {disabled}        #     long {_:drugId}        # sqlPreparedStatement        #   - UPDATE tests        #   -   SET name = ?,        #   -   abbreviation = ?,        #   -   type = 'Toxicology',        #   -   testCode = 'DRUG',        #   -   disabled = cast(? as unsigned)        #   - WHERE Id = ?        #   string {drugName}        #   string {abbreviation}        #   long {disabled}        #   long {_:testId}        # sqlPreparedStatement        #   - UPDATE analyteLinks        #   - SET linkId = cast(? AS unsigned)        #   - WHERE eventId = ?        #   long {_:drugId}        #   long {_eventId}        # sqlPreparedStatement        #   - INSERT INTO analyteLinks (analyteId, linkId, linkType, eventId)        #   - VALUES (?, ?, 'drugTest', ?)        #   long {_:drugId}        #   long {_:testId}        #   long {_eventId}        # sqlPreparedStatement        #   - INSERT INTO analyteLinks (linkId, analyteId, linkType, eventId )        #   - SELECT distinct d.testId, al.analyteId, 'drugTest', ?        #   - FROM drugs d        #   - INNER JOIN analyteLinks al ON al.linkId = al.analyteId        #   - WHERE al.linkId = ?        #   long {_eventId}        #   long {_:drugId}        # ## update existing drug        # else        #   sqlPreparedStatement        #     - UPDATE drugs        #     -   SET name = ?,        #     -   abbreviation = ?,        #     -   disabled = cast(? as unsigned)        #     - WHERE Id = ?        #     - AND testId = ?        #     string {drugName}        #     string {abbreviation}        #     long {disabled}        #     long {Id}        #     long {testId}        # sqlPreparedStatement        #   - UPDATE tests        #   -   SET name = ?,        #   -   abbreviation = ?,        #   -   type = 'Toxicology',        #   -   testCode = 'DRUG',        #   -   disabled = cast(? as unsigned)        #   - WHERE Id = ?        #   string {drugName}        #   string {abbreviation}        #   long {disabled}        #   long {testId}    _ step Analytes      queueSelectRecId      form        include userAccountInfo        script          - $(document).ready(function() {          -   $('#stepFormSubmitButton').val('Create New');          - });        vertical          fieldset            legend Explanation              class= legend            vertical              li Click 'Create New' to create a new record.              li Click on the link to view or modify record.        fieldset          legend Current Tests          table            class= stdTableBasic analyteTable            id= analyteTable            sqlQuery~ select              - Id as 'Analyte Id'              - ,name 'Name'              - ,analyteGroup as 'Group'              - ,case when disabled = 0 then 'enabled' else 'disabled' end as 'Status'              - from analytes              - order by analyteGroup, name      form        include userAccountInfo        script          - $(document).ready(function(){          -   if ($('#abbreviation').val() == '') {          -     $('#analyteName').change(function() {          -       $('#abbreviation').val($('#analyteName').val());          -     });          -   }          -   if ($('#resultName').val() == '') {          -     $('#analyteName').change(function() {          -       $('#resultName').val($('#analyteName').val() + ' 1');          -     });          -   }          -   if ($('#ulq').val() == '') {          -     $('#cutoff').change(function() {          -       $('#ulq').val($('#cutoff').val() + '0');          -     });          -   }          - }); //End of Document Ready!!        formQuery~          - select Id,name,abbreviation, resultName, analyteGroup          -   , cutoff, ulq, disabled, commonDrugs          -   from analytes where Id = '{_recId}'          - union          -   (select cast('-1' as signed) ,'' as 'name','' as 'abbreviation', '' as 'resultName','' as 'analyteGroup'          -   , '' as 'cutoff', '' as 'ulq', 0 as 'disabled', '' as 'commonDrugs'          -     from dual limit 1)        formQuery~          - select linkId from analyteLinks where analyteId = '{_recId}' and linkType = 'Analyte'          - union          - (select '' as 'linkId' from dual)        vertical          text Id            screenLabel~            value= {_:Id}            style= display: none;            numeric~          text linkId            screenLabel~            id= linkId            value= {_:linkId}            style= display: none;            numeric~          text analyteName            screenLabel~ Analyte Name            id= analyteName            style= width:300px;            value= {_:name}          text abbreviation            screenLabel~ Abbreviation            id= abbreviation            style= width:300px;            value= {_:abbreviation}          text resultName            screenLabel~ Result File Name            id= resultName            style= width:300px;            value= {_:resultName}          select disabled            screenLabel~ Status            value= {_:disabled}            setName~ status            title= SETNAME:status            required~ false            option enabled              value= 0            option disabled              value= 1          select analyteGroup            screenLabel~ Analyte Group            id= analyteGroup            value= {_:analyteGroup}            setName~ analyteGroup            title= SETNAME:analyteGroup          textArea commonDrugs            screenLabel~ Common Drugs            id= commonDrugs            value= {_:commonDrugs}          text cutoff            screenLabel~ Cutoff            id= cutoff            value= {_:cutoff}          text ulq            screenLabel~ ULQ            id= ulq            value= {_:ulq}        #sqlPreparedStatement delete from analyteLinks        #  - where linkId = ?        #  - and analyteId = ?        #  - and linkType = 'Analyte'        #  long {linkId}        #  long {Id}      ifCondition {Id}        advanced~        equals~ -1        setFormQueryResult analyteId          value= {_getNextSequence:analyteId}          #setFormQueryResult testId          #  value= {_getNextSequence:testId}        sqlPreparedStatement insert into analytes (Id,eventId) values (?,?)          int {_:analyteId}          long {_eventId}        # sqlPreparedStatement insert into tests (Id,eventId) values (?,?)        #   int {_:testId}        #   long {_eventId}        sqlPreparedStatement update analytes set          - name = ?          - ,abbreviation = ?          - ,analyteGroup = ?          - ,resultName = ?          - ,cutoff = ?          - ,ulq = ?          - ,disabled = cast(? as unsigned)          - ,commonDrugs = ?          - where Id = ?          string {analyteName}          string {abbreviation}          string {analyteGroup}          string {resultName}          int {cutoff}          int {ulq}          int {disabled}          string {commonDrugs}          int {_:analyteId}        # sqlPreparedStatement update tests set        #   - name = ?        #   - ,abbreviation = ?        #   - ,type = 'Toxicology'        #   - ,testCode = 'ANALYTE'        #   - ,disabled = cast(? as unsigned)        #   - where Id = ?        #   string {analyteName}        #   string {abbreviation}        #   int {disabled}        #   int {_:testId}        # sqlPreparedStatement insert ignore into analyteLinks (analyteId,linkId,linkType,eventId)        #   - select ?,?, 'Analyte',?        #   int {_:analyteId}        #   int {_:testId}        #   long {_eventId}      ifCondition {Id}        advanced~        not~          equals~ -1        sqlPreparedStatement update analytes set          - name = ?          - ,abbreviation = ?          - ,analyteGroup = ?          - ,resultName = ?          - ,cutoff = ?          - ,ulq = ?          - ,disabled = cast(? as unsigned)          - ,commonDrugs = ?          - where Id = ?          string {analyteName}          string {abbreviation}          string {analyteGroup}          string {resultName}          int {cutoff}          int {ulq}          int {disabled}          string {commonDrugs}          int {Id}        # sqlPreparedStatement update tests set        #   - name = ?        #   - ,abbreviation = ?        #   - ,type = 'Toxicology'        #   - ,testCode = 'ANALYTE'        #   - ,disabled = cast(? as unsigned)        #   - where Id = ?        #   string {analyteName}        #   string {abbreviation}        #   int {disabled}        #   int {linkId}        # sqlPreparedStatement        #   - insert ignore into analyteLinks (analyteId,linkId,linkType,eventId)        #   - select ?,?, 'Analyte',?        #   int {Id}        #   int {linkId}        #   long {_eventId}